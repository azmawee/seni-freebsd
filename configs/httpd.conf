# =============================================
# Konfigurasi Pelayan Web Apache
# =============================================

# ============================
# 1. Tetapan Global Pelayan
# ============================
ServerRoot "/usr/local"
Listen 80
Listen 443
ServerAdmin azmawee@yahoo.com
ServerTokens Prod
ServerSignature Off
ServerName localhost

# ============================
# 2. Muat Modul
# ============================
LoadModule unixd_module libexec/apache24/mod_unixd.so
LoadModule log_config_module libexec/apache24/mod_log_config.so
LoadModule mpm_prefork_module libexec/apache24/mod_mpm_prefork.so
LoadModule mime_module libexec/apache24/mod_mime.so
LoadModule authz_core_module libexec/apache24/mod_authz_core.so
LoadModule access_compat_module libexec/apache24/mod_access_compat.so
LoadModule alias_module libexec/apache24/mod_alias.so
LoadModule dir_module libexec/apache24/mod_dir.so
LoadModule ssl_module libexec/apache24/mod_ssl.so
LoadModule rewrite_module libexec/apache24/mod_rewrite.so
LoadModule authn_core_module libexec/apache24/mod_authn_core.so
LoadModule authn_file_module libexec/apache24/mod_authn_file.so
LoadModule authz_host_module libexec/apache24/mod_authz_host.so
LoadModule headers_module libexec/apache24/mod_headers.so
LoadModule setenvif_module libexec/apache24/mod_setenvif.so
LoadModule socache_shmcb_module libexec/apache24/mod_socache_shmcb.so
LoadModule php_module         libexec/apache24/libphp.so
# load modul
LoadModule remoteip_module libexec/apache24/mod_remoteip.so

# ambil IP asal visitor dari Cloudflare
RemoteIPHeader CF-Connecting-IP
# Senarai rangkaian Cloudflare (letak dalam file supaya senang update)
RemoteIPTrustedProxyList "/usr/local/etc/apache24/cloudflare_ips.conf"

IncludeOptional /usr/local/etc/apache24/modules.d/*.conf
Include /usr/local/etc/apache24/extra/httpd-mpm.conf
IncludeOptional /usr/local/etc/apache24/Includes/php.conf

# ============================
# 2A. Sokongan untuk Fail PHP
# ============================
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
</FilesMatch>

<FilesMatch "\.phps$">
    SetHandler application/x-httpd-php-source
</FilesMatch>

# ============================
# 3. Jenis MIME
# ============================
<IfModule mime_module>
    TypesConfig /usr/local/etc/apache24/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
</IfModule>

# ============================
# 4. Pengguna/Kumpulan
# ============================
User www
Group www

# ============================
# 5. Prestasi & Keselamatan Pelayan
# ============================
Timeout 60
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 5
HostnameLookups Off

# ============================
# 6. Log Pelayan
# ============================
#LogFormat "%h %l %u %t \"%r\" %>s %b" common
#LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined

#ErrorLog "/var/log/mxau.my-error.log"
#CustomLog "/var/log/mxau.my-access.log" combined

# ============================
# 7. Sertakan Fail Konfigurasi Tambahan
# ============================
IncludeOptional /usr/local/etc/apache24/Includes/*.conf

# ============================
# 8. Fail Utama Lalai (Directory Index)
# ============================
<IfModule dir_module>
    DirectoryIndex index.php index.html
</IfModule>

# ============================
# 9. VirtualHost HTTP (Port 80)
# ============================
<VirtualHost *:80>
    ServerName localhost
    Redirect permanent / https://freebsd.my/
</VirtualHost>

# ============================
# 10. VirtualHost HTTPS (mxau.my)
# ============================
<VirtualHost *:443>
    ServerAdmin azmawee@yahoo.com
    ServerName mxau.my
    ServerAlias www.mxau.my

    DocumentRoot /mnt/vm/www/mxau.my

    SSLEngine on
    SSLCertificateFile "/usr/local/etc/letsencrypt/live/mxau.my/fullchain.pem"
    SSLCertificateKeyFile "/usr/local/etc/letsencrypt/live/mxau.my/privkey.pem"

    DirectoryIndex index.php index.html

    <Directory "/mnt/vm/www/mxau.my">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Log format dengan IP visitor sebenar (%a)
    LogFormat "%a %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" vhost443_combined
    CustomLog "/var/log/mxau.my-access.log" vhost443_combined
    ErrorLog  "/var/log/mxau.my-error.log"
</VirtualHost>

# ============================
# 10.1 VirtualHost HTTPS (freebsd.my)
# ============================
<VirtualHost *:443>
    ServerAdmin azmawee@yahoo.com
    ServerName freebsd.my
    ServerAlias www.freebsd.my

    DocumentRoot /mnt/vm/www/freebsd.my

    SSLEngine on
    SSLCertificateFile "/usr/local/etc/letsencrypt/live/freebsd.my/fullchain.pem"
    SSLCertificateKeyFile "/usr/local/etc/letsencrypt/live/freebsd.my/privkey.pem"

    DirectoryIndex index.php index.html

    <Directory "/mnt/vm/www/freebsd.my">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Log format dengan IP visitor sebenar (%a)
    LogFormat "%a %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" vhost443_combined
    CustomLog "/var/log/freebsd.my-access.log" vhost443_combined
    ErrorLog  "/var/log/freebsd.my-error.log"

</VirtualHost>

# ============================
# 11. VirtualHost HTTPS (azmawee.com)
# ============================
<VirtualHost *:443>
    ServerAdmin azmawee@yahoo.com
    ServerName azmawee.com
    ServerAlias www.azmawee.com maui.runbsd.io

    DocumentRoot "/mnt/vm/www/azmawee"

    SSLEngine on
    SSLCertificateFile "/usr/local/etc/letsencrypt/live/azmawee.com/fullchain.pem"
    SSLCertificateKeyFile "/usr/local/etc/letsencrypt/live/azmawee.com/privkey.pem"

    DirectoryIndex index.php index.html

    <Directory "/mnt/vm/www/azmawee">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog "/var/log/azmawee.com-error.log"
    CustomLog "/var/log/azmawee.com-access.log" combined
</VirtualHost>

<VirtualHost *:443>
    ServerAdmin azmawee@yahoo.com
    ServerName audiomonsta.azmawee.com

    DocumentRoot /mnt/vm/www/audiomonsta

    SSLEngine on
    SSLCertificateFile "/usr/local/etc/letsencrypt/live/azmawee.com/fullchain.pem"
    SSLCertificateKeyFile "/usr/local/etc/letsencrypt/live/azmawee.com/privkey.pem"

    DirectoryIndex index.php index.html

    <Directory "/mnt/vm/www/audiomonsta">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    ErrorLog "/var/log/audiomonsta.azmawee.com-error.log"
    CustomLog "/var/log/audiomonsta.azmawee.com-access.log" combined
</VirtualHost>

<VirtualHost *:443>
    ServerAdmin azmawee@yahoo.com
    ServerName leetgamers.azmawee.com

    DocumentRoot /mnt/vm/www/leetgamers

    SSLEngine on
    SSLCertificateFile "/usr/local/etc/letsencrypt/live/azmawee.com/fullchain.pem"
    SSLCertificateKeyFile "/usr/local/etc/letsencrypt/live/azmawee.com/privkey.pem"

    DirectoryIndex index.php index.html

    <Directory "/mnt/vm/www/leetgamers">
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

    # Log format dengan IP visitor sebenar (%a)
    LogFormat "%a %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" vhost443_combined
    CustomLog "/var/log/azmawee.com-access.log" vhost443_combined
    ErrorLog  "/var/log/azmawee.com-error.log"

</VirtualHost>

# ============================
# 12. Tetapan SSL Lalai
# ============================
<IfModule ssl_module>
    SSLRandomSeed startup builtin
    SSLRandomSeed connect builtin
</IfModule>

# ============================
# 13. Pastikan Folder DocumentRoot Wujud
# ============================
<IfDefine DUMMYFOLDERCHECK>
    # Seksyen ini adalah pilihan dan hanya sebagai peringatan
    # Pastikan semua folder wujud atau Apache akan gagal untuk mula
    # mkdir -p /mnt/vm/www/mxau.my
    # mkdir -p /mnt/vm/www/audiomonsta
    # mkdir -p /mnt/vm/www/leetgamers
    # mkdir -p /mnt/vm/www/azmawee
</IfDefine>


