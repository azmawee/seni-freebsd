# SEC rules untuk blocking HTTP/SSH brute-force dan web attack patterns melalui pfctl table <blacklist>

# =============================
# HTTP Doser pattern (wp-admin)
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) (\S+) (\S+) (\S+) (\S+) .*GET /wp-admin/load-scripts.php\?.* (.*)
desc=httpd Doser attack from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=10
window=5

type=singlewiththreshold
ptype=regexp
pattern=(\S+) (\S+) (\S+) (\S+) (\S+) (\S+) .*GET /wp-admin/load-scripts.php\?.* (.*)
desc=httpd Doser attack from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=10
window=5

# =============================
# HTTP GET flood (generic)
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) (\S+) (\S+) (\S+) (\S+) .*GET /\?.* (.*)
desc=httpd GET flood from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=36
window=4

# =============================
# Max GET limit flood
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) (\S+) (\S+) (\S+) (\S+) (.*)GET(.*) (.*)
desc=httpd GET flood max from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=290
window=3

# =============================
# HTTP POST flood
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) (\S+) (\S+) (\S+) (\S+) (.*)POST(.*) (.*)
desc=httpd POST flood from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=60
window=5

# =============================
# HTTP OPTIONS abuse
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) (\S+) (\S+) (\S+) (\S+) (.*)OPTION(.*) (.*)
desc=httpd OPTION abuse from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=36
window=4

# =============================
# HTTP HEAD abuse
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) (\S+) (\S+) (\S+) (\S+) (.*)HEAD(.*) (.*)
desc=httpd HEAD abuse from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=36
window=4

# =============================
# HTTP minus user-agent abuse
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) (\S+) (\S+) (\S+) (\S+) "-"(.*) (.*)
desc=httpd bad user-agent from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=36
window=4

# =============================
# SSH Brute Force
# =============================
type=singlewiththreshold
ptype=regexp
pattern=.*sshd.*Failed password.*from (\S+)
desc=SSH brute-force from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=10
window=60

# =============================
# NEW: SQL Injection pattern
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) .*GET .*(union|select|concat|sleep\().*HTTP.*
desc=httpd SQLi attempt from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=15
window=10

# =============================
# NEW: XSS pattern
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) .*GET .*(<script>|%3Cscript%3E).*HTTP.*
desc=httpd XSS attempt from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=15
window=10

# =============================
# NEW: Path Traversal
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) .*GET .*\/\.\.\/.*HTTP.*
desc=httpd Path Traversal attempt from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=15
window=10

# =============================
# NEW: PHP Shell upload / exec
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) .*POST .*\.php.*HTTP.*
desc=httpd suspicious PHP POST from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=15
window=10

# =============================
# NEW: Suspicious User-Agent (curl, wget, python, sqlmap)
# =============================
type=singlewiththreshold
ptype=regexp
pattern=(\S+) .*" (GET|POST) .*HTTP.*" .*"(curl|wget|python|sqlmap).*"
desc=httpd suspicious user-agent from $1
action=shellcmd /usr/sbin/pfctl -t blacklist -T add $1
thresh=15
window=10

